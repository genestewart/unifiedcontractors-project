var b=Object.defineProperty,k=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var p=(e,t,a)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,l=(e,t)=>{for(var a in t||(t={}))y.call(t,a)&&p(e,a,t[a]);if(f)for(var a of f(t))F.call(t,a)&&p(e,a,t[a]);return e},h=(e,t)=>k(e,_(t));var d=(e,t,a)=>new Promise((r,s)=>{var i=c=>{try{o(a.next(c))}catch(g){s(g)}},n=c=>{try{o(a.throw(c))}catch(g){s(g)}},o=c=>c.done?r(c.value):Promise.resolve(c.value).then(i,n);o((a=a.apply(e,t)).next())});import{d as w}from"./vue-vendor-DAChQ3rz.js";import{g as u}from"../assets/index-wFKlhvRq.js";const x=w("feedback",{state:()=>({feedback:[],currentFeedback:null,loading:!1,error:null,pagination:{current_page:1,per_page:10,total:0,last_page:1},filters:{search:"",project_id:null,status:"",rating:null,date_from:null,date_to:null},statistics:{total_feedback:0,average_rating:0,by_status:{},by_rating:{},recent_feedback:[]}}),getters:{filteredFeedback:e=>{let t=[...e.feedback];if(e.filters.search){const a=e.filters.search.toLowerCase();t=t.filter(r=>{var s,i,n,o;return((s=r.comment)==null?void 0:s.toLowerCase().includes(a))||((i=r.client_name)==null?void 0:i.toLowerCase().includes(a))||((o=(n=r.project)==null?void 0:n.name)==null?void 0:o.toLowerCase().includes(a))})}return e.filters.project_id&&(t=t.filter(a=>a.project_id===e.filters.project_id)),e.filters.status&&(t=t.filter(a=>a.status===e.filters.status)),e.filters.rating&&(t=t.filter(a=>a.rating===e.filters.rating)),t},feedbackByProject:e=>t=>e.feedback.filter(a=>a.project_id===t),feedbackByStatus:e=>t=>e.feedback.filter(a=>a.status===t),feedbackByRating:e=>t=>e.feedback.filter(a=>a.rating===t),recentFeedback:e=>{const t=new Date;return t.setDate(t.getDate()-7),e.feedback.filter(a=>new Date(a.created_at)>=t).sort((a,r)=>new Date(r.created_at)-new Date(a.created_at)).slice(0,5)},pendingFeedback:e=>e.feedback.filter(t=>t.status==="pending"||t.status==="under_review"),highPriorityFeedback:e=>e.feedback.filter(t=>t.rating<=2&&t.status==="pending").sort((t,a)=>t.rating-a.rating),feedbackStats:e=>{const t={total:e.feedback.length,by_status:{},by_rating:{},average_rating:0};let a=0,r=0;return e.feedback.forEach(s=>{t.by_status[s.status]||(t.by_status[s.status]=0),t.by_status[s.status]++,s.rating&&(t.by_rating[s.rating]||(t.by_rating[s.rating]=0),t.by_rating[s.rating]++,a+=s.rating,r++)}),t.average_rating=r>0?(a/r).toFixed(1):0,t}},actions:{fetchFeedback(){return d(this,arguments,function*(e={}){var t,a;this.loading=!0,this.error=null;try{const r=l(l({page:e.page||this.pagination.current_page,per_page:e.per_page||this.pagination.per_page},this.filters),e.filters);Object.keys(r).forEach(i=>{(r[i]===""||r[i]===null||r[i]===void 0)&&delete r[i]});const s=yield u.get("/feedback",{params:r});return this.feedback=s.data.data,this.pagination={current_page:s.data.meta.current_page,per_page:s.data.meta.per_page,total:s.data.meta.total,last_page:s.data.meta.last_page},s.data}catch(r){throw this.error=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to fetch feedback",console.error("Fetch feedback error:",r),r}finally{this.loading=!1}})},fetchSingleFeedback(e){return d(this,null,function*(){var t,a;this.loading=!0,this.error=null;try{const r=yield u.get(`/feedback/${e}`);return this.currentFeedback=r.data.data,r.data.data}catch(r){throw this.error=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to fetch feedback",console.error("Fetch feedback error:",r),r}finally{this.loading=!1}})},submitResponse(e,t){return d(this,null,function*(){var a,r,s;this.loading=!0,this.error=null;try{const n=(yield u.post(`/feedback/${e}/response`,t)).data.data,o=this.feedback.findIndex(c=>c.id===e);return o!==-1&&(this.feedback[o]=n),((a=this.currentFeedback)==null?void 0:a.id)===e&&(this.currentFeedback=n),this.updateStatistics(),n}catch(i){throw this.error=((s=(r=i.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to submit response",console.error("Submit response error:",i),i}finally{this.loading=!1}})},updateFeedbackStatus(e,t){return d(this,null,function*(){var a,r,s;this.loading=!0,this.error=null;try{const n=(yield u.patch(`/feedback/${e}/status`,{status:t})).data.data,o=this.feedback.findIndex(c=>c.id===e);return o!==-1&&(this.feedback[o]=n),((a=this.currentFeedback)==null?void 0:a.id)===e&&(this.currentFeedback=n),this.updateStatistics(),n}catch(i){throw this.error=((s=(r=i.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to update status",console.error("Update status error:",i),i}finally{this.loading=!1}})},resolveFeedback(e,t=""){return d(this,null,function*(){return this.updateFeedbackStatus(e,"resolved",{resolution_notes:t})})},archiveFeedback(e){return d(this,null,function*(){return this.updateFeedbackStatus(e,"archived")})},deleteFeedback(e){return d(this,null,function*(){var t,a,r;this.loading=!0,this.error=null;try{yield u.delete(`/feedback/${e}`),this.feedback=this.feedback.filter(s=>s.id!==e),((t=this.currentFeedback)==null?void 0:t.id)===e&&(this.currentFeedback=null),this.updateStatistics()}catch(s){throw this.error=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to delete feedback",console.error("Delete feedback error:",s),s}finally{this.loading=!1}})},fetchStatistics(){return d(this,null,function*(){try{const e=yield u.get("/feedback/statistics");return this.statistics=e.data.data,this.statistics}catch(e){throw console.error("Fetch feedback statistics error:",e),e}})},exportFeedback(){return d(this,arguments,function*(e={}){var t,a;try{const r=h(l(l({},this.filters),e),{export:"csv"}),s=yield u.get("/feedback/export",{params:r,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([s.data])),n=document.createElement("a");n.href=i,n.download=`feedback_export_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(i)}catch(r){throw this.error=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to export feedback",console.error("Export feedback error:",r),r}})},bulkUpdateStatus(e,t){return d(this,null,function*(){var a,r;this.loading=!0,this.error=null;try{const s=yield u.patch("/feedback/bulk-status",{feedback_ids:e,status:t});return e.forEach(i=>{const n=this.feedback.findIndex(o=>o.id===i);n!==-1&&(this.feedback[n]=h(l({},this.feedback[n]),{status:t,updated_at:new Date().toISOString()}))}),this.updateStatistics(),s.data}catch(s){throw this.error=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to bulk update status",console.error("Bulk update error:",s),s}finally{this.loading=!1}})},updateFilters(e){this.filters=l(l({},this.filters),e)},clearFilters(){this.filters={search:"",project_id:null,status:"",rating:null,date_from:null,date_to:null}},setPage(e){this.pagination.current_page=e},setPerPage(e){this.pagination.per_page=e,this.pagination.current_page=1},updateStatistics(){const e=this.feedbackStats;this.statistics=h(l({},this.statistics),{total_feedback:e.total,average_rating:parseFloat(e.average_rating),by_status:e.by_status,by_rating:e.by_rating,recent_feedback:this.recentFeedback})},clearCurrentFeedback(){this.currentFeedback=null},clearData(){this.feedback=[],this.currentFeedback=null,this.error=null,this.pagination={current_page:1,per_page:10,total:0,last_page:1},this.statistics={total_feedback:0,average_rating:0,by_status:{},by_rating:{},recent_feedback:[]}},formatRating(e){return{1:"Poor",2:"Fair",3:"Good",4:"Very Good",5:"Excellent"}[e]||"Not Rated"},getRatingColor(e){return{1:"red",2:"orange",3:"yellow",4:"blue",5:"green"}[e]||"gray"}}});export{x as u};
