var Q=Object.defineProperty;var R=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var B=(v,c,l)=>c in v?Q(v,c,{enumerable:!0,configurable:!0,writable:!0,value:l}):v[c]=l,M=(v,c)=>{for(var l in c||(c={}))K.call(c,l)&&B(v,l,c[l]);if(R)for(var l of R(c))X.call(c,l)&&B(v,l,c[l]);return v};var I=(v,c,l)=>new Promise((D,n)=>{var k=_=>{try{j(l.next(_))}catch(m){n(m)}},y=_=>{try{j(l.throw(_))}catch(m){n(m)}},j=_=>_.done?D(_.value):Promise.resolve(_.value).then(k,y);j((l=l.apply(v,c)).next())});import{a as z,S as E,y as Z,U as ee,m as C,w as g,J as te,o as r,b as e,e as f,c as d,p as h,u as a,C as u,j as U,F as P,H as b,n as F}from"../chunks/vue-vendor-DAChQ3rz.js";import{_ as se,b as ne}from"../assets/index-wFKlhvRq.js";import{u as ie,C as oe}from"../chunks/ClientReviewLayout-ByHysOP-.js";import{s as w}from"../chunks/card.esm-CiQ1Wq-4.js";import{a as L,s as N}from"../chunks/button.esm-tVDeXX10.js";import{s as ae}from"../chunks/dialog.esm-CYAWXk5o.js";import{s as re}from"../chunks/progressbar.esm-Cqhb3WYw.js";import"../chunks/inputtext.esm-DAhs_0Nh.js";import"../chunks/progressspinner.esm-Hrgp9709.js";const le={class:"client-review-page"},ce={class:"welcome-section"},de={class:"welcome-content"},ue={key:0,class:"project-summary"},pe={class:"summary-grid"},me={class:"summary-item"},ve={class:"summary-value"},ge={class:"summary-item"},_e={class:"summary-value"},he={class:"summary-item"},ye={class:"progress-container"},fe={class:"progress-text"},we={class:"summary-item"},ke={class:"summary-value"},je={class:"actions-section"},De={class:"actions-grid"},Ce={class:"action-content"},Pe={class:"action-content"},be={key:0,class:"updates-section"},Fe={class:"updates-list"},Te={class:"update-content"},Se={class:"update-header"},$e={class:"update-info"},Ie={class:"update-title"},Ue={class:"update-date"},xe={class:"update-description"},Ve={key:0,class:"update-images"},Re=["onClick"],Be=["src","alt"],Me={key:1,class:"timeline-section"},ze={class:"timeline"},Ee={class:"timeline-marker"},Le={class:"timeline-content"},Ne={class:"timeline-title"},We={class:"timeline-description"},Ae={class:"timeline-date"},He={key:2,class:"categories-section"},Oe={class:"categories-grid"},Ye={class:"category-content"},qe={class:"category-icon"},Ge={class:"category-name"},Je={class:"category-count"},Qe={key:0,class:"category-preview"},Ke=["src","alt"],Xe={class:"contact-section"},Ze={class:"viewer-header"},et={key:0,class:"image-viewer"},tt=["src","alt"],st={class:"viewer-actions"},nt={__name:"ClientReviewView",props:{token:{type:String,required:!0}},setup(v){const c=v;te();const l=ee(),D=ne(),n=ie(),k=z(!1),y=z(null),j=E(()=>{if(!n.projectFiles.length)return[];const i=[],t=n.projectFiles.filter(o=>{const p=new Date(o.created_at),$=new Date(Date.now()-10080*60*1e3);return p>$}).sort((o,p)=>new Date(p.created_at)-new Date(o.created_at)),s={};return t.forEach(o=>{const p=new Date(o.created_at).toDateString();s[p]||(s[p]=[]),s[p].push(o)}),Object.entries(s).forEach(([o,p])=>{i.push({id:o,type:p[0].category||"general",title:`${p.length} new ${p[0].category==="progress"?"progress photos":"files"} added`,description:`Recent project updates with ${p.length} new files`,date:new Date(o),images:p.filter($=>{var V;return(V=$.mime_type)==null?void 0:V.startsWith("image/")})})}),i.slice(0,3)}),_=E(()=>{if(!n.currentProject)return[];const i=new Date(n.currentProject.start_date);return[{title:"Project Started",description:"Initial planning and preparation phase",date:i,completed:!0,current:!1},{title:"Foundation Work",description:"Site preparation and foundation installation",date:new Date(i.getTime()+10080*60*1e3),completed:n.currentProject.status!=="planning",current:n.currentProject.status==="in_progress"&&m()<30},{title:"Structural Phase",description:"Framing and structural components",date:new Date(i.getTime()+504*60*60*1e3),completed:m()>=50,current:n.currentProject.status==="in_progress"&&m()>=30&&m()<70},{title:"Finishing Phase",description:"Interior and exterior finishing work",date:new Date(i.getTime()+1080*60*60*1e3),completed:m()>=80,current:n.currentProject.status==="in_progress"&&m()>=70},{title:"Project Completion",description:"Final inspections and handover",date:n.currentProject.end_date?new Date(n.currentProject.end_date):new Date(i.getTime()+1440*60*60*1e3),completed:n.currentProject.status==="completed",current:!1}]}),m=()=>{if(!n.currentProject)return 0;const i=n.currentProject.status;return{planning:10,in_progress:60,on_hold:45,completed:100,cancelled:0}[i]||0},T=i=>i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"TBD",W=i=>{const s=Math.abs(new Date-i),o=Math.ceil(s/(1e3*60*60*24));return o===1?"Yesterday":o<7?`${o} days ago`:o<30?`${Math.ceil(o/7)} weeks ago`:T(i.toISOString())},A=i=>({progress:"pi-camera",documents:"pi-file-pdf",general:"pi-info-circle",materials:"pi-box",permits:"pi-verified"})[i]||"pi-circle",H=i=>i.completed?"pi-check-circle":i.current?"pi-cog":"pi-circle",x=i=>i.files.filter(t=>{var s;return(s=t.mime_type)==null?void 0:s.startsWith("image/")}).slice(0,3),S=(i=null)=>{l.push({name:"client-gallery",params:M({token:c.token},i&&{category:i})})},O=()=>{S("documents")},Y=i=>{S(i)},q=()=>{l.push({name:"client-feedback",params:{token:c.token}})},G=i=>{y.value=i,k.value=!0},J=()=>I(null,null,function*(){if(y.value)try{yield n.downloadFile(y.value),D.add({severity:"success",summary:"Download Started",detail:"Image download initiated",life:2e3})}catch(i){D.add({severity:"error",summary:"Download Failed",detail:i.message,life:3e3})}});return Z(()=>I(null,null,function*(){c.token&&((yield n.validateToken(c.token))?yield n.loadProjectData():(D.add({severity:"error",summary:"Invalid Access",detail:"This link has expired or is invalid",life:5e3}),setTimeout(()=>{l.push({name:"client-help"})},3e3)))})),(i,t)=>(r(),C(oe,null,{default:g(()=>[e("div",le,[e("section",ce,[f(a(w),{class:"welcome-card"},{content:g(()=>[e("div",de,[t[10]||(t[10]=e("div",{class:"welcome-icon"},[e("i",{class:"pi pi-home"})],-1)),t[11]||(t[11]=e("h1",{class:"welcome-title"},"Welcome to Your Project Review",-1)),t[12]||(t[12]=e("p",{class:"welcome-description"}," Track your construction project progress, view photos and documents, and provide feedback to your construction team. ",-1)),a(n).currentProject?(r(),d("div",ue,[e("div",pe,[e("div",me,[t[6]||(t[6]=e("span",{class:"summary-label"},"Project Type",-1)),e("span",ve,u(a(n).currentProject.type||"Construction Project"),1)]),e("div",ge,[t[7]||(t[7]=e("span",{class:"summary-label"},"Start Date",-1)),e("span",_e,u(T(a(n).currentProject.start_date)),1)]),e("div",he,[t[8]||(t[8]=e("span",{class:"summary-label"},"Progress",-1)),e("div",ye,[f(a(re),{value:m(),class:"progress-bar"},null,8,["value"]),e("span",fe,u(m())+"%",1)])]),e("div",we,[t[9]||(t[9]=e("span",{class:"summary-label"},"Last Updated",-1)),e("span",ke,u(T(a(n).currentProject.updated_at)),1)])])])):h("",!0)])]),_:1})]),e("section",je,[e("div",De,[f(a(w),{class:"action-card",onClick:t[0]||(t[0]=s=>S())},{content:g(()=>[e("div",Ce,[t[13]||(t[13]=e("div",{class:"action-icon gallery"},[e("i",{class:"pi pi-images"})],-1)),t[14]||(t[14]=e("h3",null,"View Photos",-1)),e("p",null,"Browse "+u(a(n).imageFiles.length)+" project photos",1),a(n).imageFiles.length?(r(),C(a(L),{key:0,value:a(n).imageFiles.length,severity:"info",class:"action-badge"},null,8,["value"])):h("",!0)])]),_:1}),f(a(w),{class:"action-card",onClick:t[1]||(t[1]=s=>O())},{content:g(()=>[e("div",Pe,[t[15]||(t[15]=e("div",{class:"action-icon documents"},[e("i",{class:"pi pi-file"})],-1)),t[16]||(t[16]=e("h3",null,"View Documents",-1)),e("p",null,"Access "+u(a(n).documentFiles.length)+" project files",1),a(n).documentFiles.length?(r(),C(a(L),{key:0,value:a(n).documentFiles.length,severity:"secondary",class:"action-badge"},null,8,["value"])):h("",!0)])]),_:1}),f(a(w),{class:"action-card",onClick:t[2]||(t[2]=s=>q())},{content:g(()=>t[17]||(t[17]=[e("div",{class:"action-content"},[e("div",{class:"action-icon feedback"},[e("i",{class:"pi pi-star"})]),e("h3",null,"Share Feedback"),e("p",null,"Rate your experience and leave comments")],-1)])),_:1})])]),j.value.length?(r(),d("section",be,[t[18]||(t[18]=e("h2",{class:"section-title"},[e("i",{class:"pi pi-clock"}),U(" Recent Updates ")],-1)),e("div",Fe,[(r(!0),d(P,null,b(j.value,s=>(r(),C(a(w),{key:s.id,class:"update-card"},{content:g(()=>[e("div",Te,[e("div",Se,[e("div",{class:F(["update-icon",s.type])},[e("i",{class:F(A(s.type))},null,2)],2),e("div",$e,[e("h4",Ie,u(s.title),1),e("span",Ue,u(W(s.date)),1)])]),e("p",xe,u(s.description),1),s.images&&s.images.length?(r(),d("div",Ve,[(r(!0),d(P,null,b(s.images.slice(0,3),o=>(r(),d("div",{key:o.id,class:"update-image",onClick:p=>G(o)},[e("img",{src:a(n).getThumbnailUrl(o,"small"),alt:o.filename,loading:"lazy"},null,8,Be)],8,Re))),128)),s.images.length>3?(r(),d("div",{key:0,class:"more-images",onClick:t[3]||(t[3]=o=>S())},[e("span",null,"+"+u(s.images.length-3)+" more",1)])):h("",!0)])):h("",!0)])]),_:2},1024))),128))])])):h("",!0),_.value.length?(r(),d("section",Me,[t[19]||(t[19]=e("h2",{class:"section-title"},[e("i",{class:"pi pi-calendar"}),U(" Project Timeline ")],-1)),e("div",ze,[(r(!0),d(P,null,b(_.value,(s,o)=>(r(),d("div",{key:o,class:F(["timeline-item",{completed:s.completed,current:s.current,future:!s.completed&&!s.current}])},[e("div",Ee,[e("i",{class:F(H(s))},null,2)]),e("div",Le,[e("h4",Ne,u(s.title),1),e("p",We,u(s.description),1),e("span",Ae,u(T(s.date)),1)])],2))),128))])])):h("",!0),a(n).fileCategories.length?(r(),d("section",He,[t[20]||(t[20]=e("h2",{class:"section-title"},[e("i",{class:"pi pi-folder"}),U(" File Categories ")],-1)),e("div",Oe,[(r(!0),d(P,null,b(a(n).fileCategories,s=>(r(),C(a(w),{key:s.name,class:"category-card",onClick:o=>Y(s.name)},{content:g(()=>[e("div",Ye,[e("div",qe,[e("i",{class:F(s.icon)},null,2)]),e("h4",Ge,u(s.label),1),e("span",Je,u(s.count)+" files",1),x(s).length?(r(),d("div",Qe,[(r(!0),d(P,null,b(x(s),o=>(r(),d("div",{key:o.id,class:"preview-image"},[e("img",{src:a(n).getThumbnailUrl(o,"small"),alt:o.filename,loading:"lazy"},null,8,Ke)]))),128))])):h("",!0)])]),_:2},1032,["onClick"]))),128))])])):h("",!0),e("section",Xe,[f(a(w),{class:"contact-card"},{content:g(()=>t[21]||(t[21]=[e("div",{class:"contact-content"},[e("div",{class:"contact-icon"},[e("i",{class:"pi pi-phone"})]),e("div",{class:"contact-info"},[e("h3",null,"Have Questions?"),e("p",null,"Contact your project team anytime for updates or concerns."),e("div",{class:"contact-methods"},[e("a",{href:"tel:+1-435-555-0123",class:"contact-method"},[e("i",{class:"pi pi-phone"}),e("span",null,"Call Us")]),e("a",{href:"mailto:info@unifiedcontractors.com",class:"contact-method"},[e("i",{class:"pi pi-envelope"}),e("span",null,"Email Us")])])])],-1)])),_:1})])]),f(a(ae),{visible:k.value,"onUpdate:visible":t[5]||(t[5]=s=>k.value=s),style:{width:"95vw",height:"95vh"},modal:"",maximizable:"",class:"image-viewer-dialog",contentStyle:{padding:0}},{header:g(()=>{var s;return[e("div",Ze,[e("span",null,u((s=y.value)==null?void 0:s.filename),1)])]}),footer:g(()=>[e("div",st,[f(a(N),{label:"Download",icon:"pi pi-download",onClick:J,severity:"secondary"}),f(a(N),{label:"Close",onClick:t[4]||(t[4]=s=>k.value=!1)})])]),default:g(()=>[y.value?(r(),d("div",et,[e("img",{src:a(n).getFileUrl(y.value),alt:y.value.filename,class:"viewer-image"},null,8,tt)])):h("",!0)]),_:1},8,["visible"])]),_:1}))}},vt=se(nt,[["__scopeId","data-v-f47be360"]]);export{vt as default};
