var b=(x,k,a)=>new Promise((m,p)=>{var C=n=>{try{v(a.next(n))}catch(h){p(h)}},f=n=>{try{v(a.throw(n))}catch(h){p(h)}},v=n=>n.done?m(n.value):Promise.resolve(n.value).then(C,f);v((a=a.apply(x,k)).next())});import{_ as E,a as V,b as A}from"../assets/index-wFKlhvRq.js";import{u as I,F as G}from"../chunks/FileUpload-sNRo3nLA.js";import{s as K}from"../chunks/card.esm-CiQ1Wq-4.js";import{s as d,a as O}from"../chunks/button.esm-tVDeXX10.js";import{s as q}from"../chunks/breadcrumb.esm-C9yKBWP_.js";import{s as H,a as y}from"../chunks/column.esm-ObKttWdy.js";import{a as $,y as J,c as w,b as s,e as l,u as i,w as r,E as Q,A as W,o as _,n as X,p as j,C as u,j as S,g as F,m as U}from"../chunks/vue-vendor-DAChQ3rz.js";import"../chunks/dialog.esm-CYAWXk5o.js";import"../chunks/fileupload.esm-BgVAjcEe.js";import"../chunks/index.esm-Bg6elBM9.js";import"../chunks/message.esm-CdnHGpMk.js";import"../chunks/progressbar.esm-Cqhb3WYw.js";import"../chunks/dropdown.esm-DKpLOg4v.js";import"../chunks/index.esm-CD-3j7eP.js";import"../chunks/overlayeventbus.esm-B_8idrPH.js";import"../chunks/inputtext.esm-DAhs_0Nh.js";import"../chunks/checkbox.esm-4WzbJXiL.js";const Y={class:"files-view"},Z={class:"page-header"},ee={class:"header-content"},oe={class:"header-info"},te={class:"header-actions"},ie={class:"files-content"},se={class:"file-item"},le={class:"file-info"},ae={key:0},re={key:0,class:"project-link"},ne={key:1,class:"no-project"},pe={class:"upload-info"},ce={class:"file-actions"},de={class:"empty-state"},ue={__name:"FilesView",setup(x){const k=V(),a=I(),m=A(),p=$(!1),C=$([{label:"Dashboard",icon:"pi pi-home",route:"/employee/dashboard"},{label:"Files"}]),f=()=>b(null,null,function*(){yield a.fetchFiles()}),v=e=>{a.setPage(e.page+1),a.setPerPage(e.rows),f()},n=e=>{p.value=!1,f(),m.add({severity:"success",summary:"Success",detail:`${e.length} file(s) uploaded successfully`,life:3e3})},h=e=>{},D=e=>b(null,null,function*(){try{yield a.downloadFile(e.id,e.original_name)}catch(t){m.add({severity:"error",summary:"Error",detail:"Failed to download file",life:3e3})}}),L=e=>{},M=e=>b(null,null,function*(){if(confirm(`Are you sure you want to delete ${e.original_name}?`))try{yield a.deleteFile(e.id),m.add({severity:"success",summary:"Success",detail:"File deleted successfully",life:3e3})}catch(t){m.add({severity:"error",summary:"Error",detail:"Failed to delete file",life:3e3})}}),B=e=>{if(e===0)return"0 Bytes";const t=1024,g=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,c)).toFixed(2))+" "+g[c]},N=e=>e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",R=e=>e?new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",T=e=>({pdf:"pi pi-file-pdf",doc:"pi pi-file-word",docx:"pi pi-file-word",xls:"pi pi-file-excel",xlsx:"pi pi-file-excel",jpg:"pi pi-image",jpeg:"pi pi-image",png:"pi pi-image",gif:"pi pi-image"})[e==null?void 0:e.toLowerCase()]||"pi pi-file",z=e=>{var g;return["jpg","jpeg","png","gif","pdf"].includes((g=e.file_extension)==null?void 0:g.toLowerCase())};return J(()=>b(null,null,function*(){document.title="File Management - Employee Portal",yield f()})),(e,t)=>{const g=Q("router-link"),c=W("tooltip");return _(),w("div",Y,[s("div",Z,[s("div",ee,[s("div",oe,[l(i(q),{model:C.value},null,8,["model"]),t[3]||(t[3]=s("h1",null,"File Management",-1)),t[4]||(t[4]=s("p",null,"Upload and manage project files",-1))]),s("div",te,[l(i(d),{icon:"pi pi-upload",label:"Upload Files",onClick:t[0]||(t[0]=o=>p.value=!0)}),l(i(d),{icon:"pi pi-refresh",label:"Refresh",onClick:f,loading:i(a).loading,severity:"secondary",outlined:""},null,8,["loading"])])])]),s("div",ie,[l(G,{visible:p.value,"onUpdate:visible":t[1]||(t[1]=o=>p.value=o),onFilesUploaded:n},null,8,["visible"]),l(i(K),{class:"files-card"},{content:r(()=>[l(i(H),{value:i(a).files,loading:i(a).loading,paginator:!0,rows:i(a).pagination.per_page,totalRecords:i(a).pagination.total,lazy:!0,onPage:v,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} entries",responsiveLayout:"scroll",class:"files-table"},{empty:r(()=>[s("div",de,[t[5]||(t[5]=s("i",{class:"pi pi-file-o empty-icon"},null,-1)),t[6]||(t[6]=s("h3",null,"No files found",-1)),t[7]||(t[7]=s("p",null,"Upload your first file to get started.",-1)),l(i(d),{label:"Upload Files",onClick:t[2]||(t[2]=o=>p.value=!0)})])]),default:r(()=>[l(i(y),{field:"original_name",header:"File Name",sortable:!0},{body:r(({data:o})=>[s("div",se,[s("i",{class:X(T(o.file_extension))},null,2),s("div",le,[s("strong",null,u(o.original_name),1),o.description?(_(),w("small",ae,u(o.description),1)):j("",!0)])])]),_:1}),l(i(y),{field:"project",header:"Project",sortable:!0},{body:r(({data:o})=>[o.project?(_(),w("div",re,[l(g,{to:`/employee/projects/${o.project.id}`},{default:r(()=>[S(u(o.project.name),1)]),_:2},1032,["to"]),s("small",null,u(o.project.client_name),1)])):(_(),w("span",ne,"No project"))]),_:1}),l(i(y),{field:"category",header:"Category",sortable:!0},{body:r(({data:o})=>[l(i(O),{value:o.category,severity:"secondary"},null,8,["value"])]),_:1}),l(i(y),{field:"file_size",header:"Size",sortable:!0},{body:r(({data:o})=>[S(u(B(o.file_size)),1)]),_:1}),l(i(y),{field:"created_at",header:"Uploaded",sortable:!0},{body:r(({data:o})=>[s("div",pe,[s("span",null,u(N(o.created_at)),1),s("small",null,u(R(o.created_at)),1)])]),_:1}),l(i(y),{header:"Actions"},{body:r(({data:o})=>[s("div",ce,[z(o)?F((_(),U(i(d),{key:0,icon:"pi pi-eye",onClick:P=>h(o),class:"p-button-text p-button-sm"},null,8,["onClick"])),[[c,"Preview"]]):j("",!0),F(l(i(d),{icon:"pi pi-download",onClick:P=>D(o),class:"p-button-text p-button-sm"},null,8,["onClick"]),[[c,"Download"]]),F(l(i(d),{icon:"pi pi-pencil",onClick:P=>L(o),class:"p-button-text p-button-sm"},null,8,["onClick"]),[[c,"Edit"]]),i(k).hasAnyRole(["admin","project_manager"])?F((_(),U(i(d),{key:1,icon:"pi pi-trash",onClick:P=>M(o),class:"p-button-text p-button-sm",severity:"danger"},null,8,["onClick"])),[[c,"Delete"]]):j("",!0)])]),_:1})]),_:1},8,["value","loading","rows","totalRecords"])]),_:1})])])}}},De=E(ue,[["__scopeId","data-v-002bdf98"]]);export{De as default};
