var U=(N,F,m)=>new Promise((n,y)=>{var h=c=>{try{v(m.next(c))}catch(i){y(i)}},w=c=>{try{v(m.throw(c))}catch(i){y(i)}},v=c=>c.done?n(c.value):Promise.resolve(c.value).then(h,w);v((m=m.apply(N,F)).next())});import{a as b,y as ae,c as p,b as l,e as a,u as s,m as R,p as j,w as d,U as ne,A as re,o as r,C,F as ie,H as ce,g as S,W as de}from"../chunks/vue-vendor-DAChQ3rz.js";import{_ as ue,a as pe,b as me}from"../assets/index-wFKlhvRq.js";import{u as ve,s as ge,a as k}from"../chunks/column.esm-ObKttWdy.js";import{s as L}from"../chunks/card.esm-CiQ1Wq-4.js";import{s as u,a as fe}from"../chunks/button.esm-tVDeXX10.js";import{s as be}from"../chunks/inputtext.esm-DAhs_0Nh.js";import{s as ye}from"../chunks/dropdown.esm-DKpLOg4v.js";import{s as he}from"../chunks/calendar.esm-C4xoRl7p.js";import{s as q}from"../chunks/avatar.esm-C27Wdo5a.js";import{s as _e}from"../chunks/breadcrumb.esm-C9yKBWP_.js";import{s as Pe}from"../chunks/dialog.esm-CYAWXk5o.js";import{P as A}from"../chunks/ProjectForm-DiTwpltI.js";import{F as je}from"../chunks/FileUpload-sNRo3nLA.js";import{d as Ce}from"../chunks/debounce-JiCZynfX.js";import"../chunks/index.esm-CD-3j7eP.js";import"../chunks/overlayeventbus.esm-B_8idrPH.js";import"../chunks/checkbox.esm-4WzbJXiL.js";import"../chunks/index.esm-Bg6elBM9.js";import"../chunks/textarea.esm-D6i7G5ct.js";import"../chunks/fileupload.esm-BgVAjcEe.js";import"../chunks/message.esm-CdnHGpMk.js";import"../chunks/progressbar.esm-Cqhb3WYw.js";const we={class:"projects-view"},ke={class:"page-header"},$e={class:"header-content"},Re={class:"header-info"},Se={class:"header-actions"},Ue={class:"filters-section"},Fe={class:"search-field"},Ve={class:"p-input-icon-left"},Ne={class:"filter-fields"},xe={class:"project-name-cell"},De={class:"project-main"},Ie={class:"project-meta"},Qe={key:0},Le={key:0,class:"budget-amount"},qe={key:1,class:"no-budget"},Ae={class:"timeline-cell"},Ee={key:0,class:"date-range"},Te={class:"end-date"},Me={key:1,class:"no-dates"},ze={class:"team-avatars"},Be={key:1,class:"no-team"},Oe={class:"action-buttons"},He={class:"empty-state"},We={key:0,class:"qr-content"},Ge={class:"qr-code-container"},Je=["src"],Ke={class:"qr-actions"},Xe={__name:"ProjectsView",setup(N){const F=ne(),m=pe(),n=ve(),y=me(),h=b(!1),w=b(!1),v=b(!1),c=b(!1),i=b(null),_=b(null),P=b(""),E=b([{label:"Dashboard",icon:"pi pi-home",route:"/employee/dashboard"},{label:"Projects"}]),T=[{label:"Pending",value:"pending"},{label:"Active",value:"active"},{label:"On Hold",value:"on_hold"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}],g=()=>U(null,null,function*(){yield n.fetchProjects()}),M=Ce(()=>{V()},500),V=()=>{n.setPage(1),g()},z=o=>{n.setPage(o.page+1),n.setPerPage(o.rows),g()},B=o=>{g()},O=()=>{_.value&&_.value.length===2?n.updateFilters({date_from:_.value[0].toISOString().split("T")[0],date_to:_.value[1].toISOString().split("T")[0]}):n.updateFilters({date_from:null,date_to:null}),V()},H=()=>{_.value=null,n.clearFilters(),g()},x=o=>{F.push(`/employee/projects/${o.id}`)},W=o=>{i.value=o,w.value=!0},G=o=>{i.value=o,v.value=!0},J=o=>U(null,null,function*(){i.value=o;try{P.value=yield n.generateQRCode(o.id),c.value=!0}catch(e){y.add({severity:"error",summary:"Error",detail:"Failed to generate QR code",life:3e3})}}),K=()=>{var o;if(P.value){const e=document.createElement("a");e.href=P.value,e.download=`project-${(o=i.value)==null?void 0:o.id}-qr.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}},X=()=>{var o;if(P.value){const e=window.open("","_blank");e.document.write(`
      <html>
        <head><title>Project QR Code</title></head>
        <body style="text-align: center; padding: 20px;">
          <h2>${(o=i.value)==null?void 0:o.name}</h2>
          <img src="${P.value}" alt="QR Code" />
          <p>Project QR Code</p>
        </body>
      </html>
    `),e.document.close(),e.print()}},Y=o=>{h.value=!1,g(),y.add({severity:"success",summary:"Success",detail:`Project "${o.name}" created successfully`,life:3e3})},Z=o=>{w.value=!1,i.value=null,g(),y.add({severity:"success",summary:"Success",detail:`Project "${o.name}" updated successfully`,life:3e3})},ee=o=>{v.value=!1,i.value=null,y.add({severity:"success",summary:"Success",detail:`${o.length} file(s) uploaded successfully`,life:3e3})},te=o=>o.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()),se=o=>({active:"success",pending:"warning",completed:"info",on_hold:"secondary",cancelled:"danger"})[o]||"secondary",oe=o=>new Intl.NumberFormat("en-US").format(o),D=o=>o?new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):null,le=o=>`${o.first_name[0]}${o.last_name[0]}`.toUpperCase();return ae(()=>U(null,null,function*(){document.title="Projects - Employee Portal",yield g()})),(o,e)=>{var I;const $=re("tooltip");return r(),p("div",we,[l("div",ke,[l("div",$e,[l("div",Re,[a(s(_e),{model:E.value},null,8,["model"]),e[9]||(e[9]=l("h1",null,"Projects",-1)),e[10]||(e[10]=l("p",null,"Manage and monitor all construction projects",-1))]),l("div",Se,[s(m).hasAnyRole(["admin","project_manager"])?(r(),R(s(u),{key:0,icon:"pi pi-plus",label:"New Project",onClick:e[0]||(e[0]=t=>h.value=!0)})):j("",!0),a(s(u),{icon:"pi pi-refresh",label:"Refresh",onClick:g,loading:s(n).loading,severity:"secondary",outlined:""},null,8,["loading"])])])]),a(s(L),{class:"filters-card"},{content:d(()=>[l("div",Ue,[l("div",Fe,[l("span",Ve,[e[11]||(e[11]=l("i",{class:"pi pi-search"},null,-1)),a(s(be),{modelValue:s(n).filters.search,"onUpdate:modelValue":e[1]||(e[1]=t=>s(n).filters.search=t),placeholder:"Search projects...",onInput:s(M),class:"search-input"},null,8,["modelValue","onInput"])])]),l("div",Ne,[a(s(ye),{modelValue:s(n).filters.status,"onUpdate:modelValue":e[2]||(e[2]=t=>s(n).filters.status=t),options:T,optionLabel:"label",optionValue:"value",placeholder:"All Status",showClear:"",onChange:V},null,8,["modelValue"]),a(s(he),{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t),selectionMode:"range",manualInput:!1,placeholder:"Date Range",onDateSelect:O,showIcon:""},null,8,["modelValue"]),a(s(u),{icon:"pi pi-filter-slash",label:"Clear",onClick:H,text:""})])])]),_:1}),a(s(L),{class:"projects-card"},{content:d(()=>[a(s(ge),{value:s(n).projects,loading:s(n).loading,paginator:!0,rows:s(n).pagination.per_page,totalRecords:s(n).pagination.total,lazy:!0,onPage:z,onSort:B,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} entries",responsiveLayout:"scroll",class:"projects-table",selectionMode:"single",onRowSelect:x},{empty:d(()=>[l("div",He,[e[14]||(e[14]=l("i",{class:"pi pi-briefcase empty-icon"},null,-1)),e[15]||(e[15]=l("h3",null,"No projects found",-1)),e[16]||(e[16]=l("p",null,"No projects match your current filters.",-1)),s(m).hasAnyRole(["admin","project_manager"])&&!s(n).filters.search?(r(),R(s(u),{key:0,label:"Create First Project",onClick:e[4]||(e[4]=t=>h.value=!0)})):j("",!0)])]),default:d(()=>[a(s(k),{field:"name",header:"Project",sortable:!0},{body:d(({data:t})=>[l("div",xe,[l("div",De,[l("strong",null,C(t.name),1),l("div",Ie,[l("small",null,"Client: "+C(t.client_name),1),t.address?(r(),p("small",Qe,C(t.city)+", "+C(t.state),1)):j("",!0)])])])]),_:1}),a(s(k),{field:"status",header:"Status",sortable:!0},{body:d(({data:t})=>[a(s(fe),{value:te(t.status),severity:se(t.status)},null,8,["value","severity"])]),_:1}),a(s(k),{field:"budget",header:"Budget",sortable:!0},{body:d(({data:t})=>[t.budget?(r(),p("span",Le," $"+C(oe(t.budget)),1)):(r(),p("span",qe,"Not set"))]),_:1}),a(s(k),{field:"start_date",header:"Timeline",sortable:!0},{body:d(({data:t})=>[l("div",Ae,[t.start_date||t.end_date?(r(),p("div",Ee,[l("div",null,[e[12]||(e[12]=l("i",{class:"pi pi-calendar"},null,-1)),l("span",null,C(D(t.start_date)||"Not set"),1)]),l("div",Te,[e[13]||(e[13]=l("i",{class:"pi pi-flag"},null,-1)),l("span",null,C(D(t.end_date)||"Not set"),1)])])):(r(),p("span",Me,"No timeline set"))])]),_:1}),a(s(k),{header:"Team"},{body:d(({data:t})=>[l("div",ze,[(r(!0),p(ie,null,ce((t.employees||[]).slice(0,3),(f,Q)=>S((r(),R(s(q),{key:f.id,label:le(f),size:"normal",style:de({marginLeft:Q>0?"-8px":"0",zIndex:10-Q}),class:"team-avatar"},null,8,["label","style"])),[[$,`${f.first_name} ${f.last_name}`]])),128)),(t.employees||[]).length>3?(r(),R(s(q),{key:0,label:`+${(t.employees||[]).length-3}`,size:"normal",style:{"margin-left":"-8px"},class:"team-avatar team-avatar-more"},null,8,["label"])):j("",!0),(t.employees||[]).length?j("",!0):(r(),p("span",Be,"No team assigned"))])]),_:1}),a(s(k),{header:"Actions"},{body:d(({data:t})=>[l("div",Oe,[S(a(s(u),{icon:"pi pi-eye",onClick:f=>x(t),class:"p-button-text p-button-sm"},null,8,["onClick"]),[[$,"View Details"]]),s(m).hasAnyRole(["admin","project_manager"])?S((r(),R(s(u),{key:0,icon:"pi pi-pencil",onClick:f=>W(t),class:"p-button-text p-button-sm"},null,8,["onClick"])),[[$,"Edit Project"]]):j("",!0),S(a(s(u),{icon:"pi pi-upload",onClick:f=>G(t),class:"p-button-text p-button-sm"},null,8,["onClick"]),[[$,"Upload Files"]]),S(a(s(u),{icon:"pi pi-qrcode",onClick:f=>J(t),class:"p-button-text p-button-sm"},null,8,["onClick"]),[[$,"Generate QR Code"]])])]),_:1})]),_:1},8,["value","loading","rows","totalRecords"])]),_:1}),a(A,{visible:h.value,"onUpdate:visible":e[5]||(e[5]=t=>h.value=t),onProjectCreated:Y},null,8,["visible"]),a(A,{visible:w.value,"onUpdate:visible":e[6]||(e[6]=t=>w.value=t),project:i.value,onProjectUpdated:Z},null,8,["visible","project"]),a(je,{visible:v.value,"onUpdate:visible":e[7]||(e[7]=t=>v.value=t),projectId:(I=i.value)==null?void 0:I.id,onFilesUploaded:ee},null,8,["visible","projectId"]),a(s(Pe),{visible:c.value,"onUpdate:visible":e[8]||(e[8]=t=>c.value=t),header:"Project QR Code",modal:!0,class:"qr-dialog"},{default:d(()=>[P.value?(r(),p("div",We,[l("div",Ge,[l("img",{src:P.value,alt:"Project QR Code",class:"qr-code-image"},null,8,Je)]),e[17]||(e[17]=l("p",null,"Scan this QR code to quickly access project details",-1)),l("div",Ke,[a(s(u),{label:"Download",icon:"pi pi-download",onClick:K}),a(s(u),{label:"Print",icon:"pi pi-print",onClick:X,severity:"secondary"})])])):j("",!0)]),_:1},8,["visible"])])}}},Pt=ue(Xe,[["__scopeId","data-v-e8dbb7c6"]]);export{Pt as default};
