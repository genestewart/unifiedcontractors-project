var f=(x,w,v)=>new Promise((C,S)=>{var n=m=>{try{p(v.next(m))}catch(i){S(i)}},L=m=>{try{p(v.throw(m))}catch(i){S(i)}},p=m=>m.done?C(m.value):Promise.resolve(m.value).then(n,L);p((v=v.apply(x,w)).next())});import{u as ee}from"../chunks/feedback-CN0rn2tF.js";import{s as c,a as B}from"../chunks/button.esm-tVDeXX10.js";import{s as be}from"../chunks/breadcrumb.esm-C9yKBWP_.js";import{a as _,S as T,t as fe,y as se,m as j,w as r,b as e,e as o,c as h,p as g,u as t,C as d,g as z,h as ge,A as _e,o as u}from"../chunks/vue-vendor-DAChQ3rz.js";import{_ as te,a as he,b as ke}from"../assets/index-wFKlhvRq.js";import{u as ye,a as R,s as we}from"../chunks/column.esm-ObKttWdy.js";import{s as Y}from"../chunks/dialog.esm-CYAWXk5o.js";import{s as Ce}from"../chunks/inputtext.esm-DAhs_0Nh.js";import{s as U}from"../chunks/dropdown.esm-DKpLOg4v.js";import{s as E}from"../chunks/card.esm-CiQ1Wq-4.js";import{s as X}from"../chunks/rating.esm-Bmiifht7.js";import{s as Z}from"../chunks/avatar.esm-C27Wdo5a.js";import{s as Se}from"../chunks/textarea.esm-D6i7G5ct.js";import{s as Fe}from"../chunks/divider.esm-ZQADHX9V.js";import{s as Re}from"../chunks/progressspinner.esm-Hrgp9709.js";import{d as $e}from"../chunks/debounce-JiCZynfX.js";import"../chunks/index.esm-CD-3j7eP.js";import"../chunks/overlayeventbus.esm-B_8idrPH.js";import"../chunks/checkbox.esm-4WzbJXiL.js";import"../chunks/index.esm-Bg6elBM9.js";const Ve={class:"feedback-container"},Pe={class:"feedback-header"},je={class:"filters-section"},Ue={class:"filter-row"},xe={class:"filter-field"},Le={class:"filter-field"},De={class:"filter-field"},Ae={class:"filter-field"},Ee={class:"actions-row"},Me={key:0,class:"feedback-stats"},Ne={class:"stat-content"},Ie={class:"stat-number"},Oe={class:"stat-content"},Be={class:"stat-number"},Te={class:"stat-content"},ze={class:"stat-number"},Ye={class:"stat-content"},qe={class:"stat-number"},Ge={class:"feedback-content"},He={class:"client-info"},Je={class:"client-avatar"},Ke={class:"client-details"},Qe={key:0,class:"project-info"},We={key:1,class:"no-project"},Xe={class:"rating-display"},Ze={class:"comment-content"},es={class:"status-container"},ss={class:"status-date"},ts={class:"action-buttons"},as={class:"loading-state"},ls={key:0,class:"feedback-detail"},os={class:"feedback-detail-header"},ns={class:"client-info"},is={class:"client-details"},rs={class:"feedback-meta"},ds={class:"rating-display"},cs={class:"rating-text"},us={class:"feedback-content"},ps={class:"feedback-comment"},vs={key:0,class:"project-context"},ms={class:"project-details"},bs={key:1,class:"feedback-response"},fs={class:"response-content"},gs={class:"form-field"},_s={key:0,class:"p-error"},hs={class:"form-field"},ks={class:"dialog-footer"},ys={__name:"ClientFeedbackList",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(x,{emit:w}){const v=x,C=w,S=he(),n=ee(),L=ye(),p=ke(),m=_([]),i=_(null),$=_(!1),V=_(!1),M=_(!1),b=_({message:"",status:"under_review"}),F=_({}),N=T({get:()=>v.visible,set:l=>C("update:visible",l)}),ae=T(()=>n.feedback.filter(l=>l.status==="pending").length),le=T(()=>n.feedback.filter(l=>l.status==="resolved").length),q=[{label:"Pending",value:"pending"},{label:"Under Review",value:"under_review"},{label:"Resolved",value:"resolved"},{label:"Archived",value:"archived"}],oe=[{label:"Mark as Under Review",value:"under_review"},{label:"Mark as Resolved",value:"resolved"},{label:"Archive",value:"archived"}],ne=[{label:"5 Stars",value:5},{label:"4 Stars",value:4},{label:"3 Stars",value:3},{label:"2 Stars",value:2},{label:"1 Star",value:1}],G=()=>f(null,null,function*(){try{yield L.fetchProjects({per_page:100}),m.value=L.projects.map(l=>({id:l.id,name:l.name,client_name:l.client_name}))}catch(l){console.error("Error loading projects:",l)}}),k=()=>f(null,null,function*(){try{yield n.fetchFeedback(),yield n.fetchStatistics()}catch(l){p.add({severity:"error",summary:"Error",detail:"Failed to refresh feedback",life:3e3})}}),D=()=>{n.setPage(1),k()},ie=$e(()=>{D()},500),re=l=>{n.setPage(l.page+1),n.setPerPage(l.rows),k()},de=()=>{n.clearFilters(),k()},ce=()=>f(null,null,function*(){try{yield n.exportFeedback(),p.add({severity:"success",summary:"Export Complete",detail:"Feedback data has been exported",life:3e3})}catch(l){p.add({severity:"error",summary:"Export Failed",detail:"Failed to export feedback data",life:3e3})}}),H=l=>{i.value=l,$.value=!0},J=l=>{i.value=l,b.value={message:"",status:"under_review"},F.value={},$.value=!1,V.value=!0},K=()=>f(null,null,function*(){if(!b.value.message.trim()){F.value.message="Response message is required";return}M.value=!0,F.value={};try{yield n.submitResponse(i.value.id,{response:b.value.message,status:b.value.status}),p.add({severity:"success",summary:"Response Sent",detail:"Your response has been sent to the client",life:3e3}),V.value=!1,k()}catch(l){p.add({severity:"error",summary:"Error",detail:"Failed to send response",life:3e3})}finally{M.value=!1}}),ue=(l,s)=>f(null,null,function*(){try{yield n.updateFeedbackStatus(l.id,s),p.add({severity:"success",summary:"Status Updated",detail:`Feedback marked as ${I(s).toLowerCase()}`,life:3e3})}catch(A){p.add({severity:"error",summary:"Error",detail:"Failed to update status",life:3e3})}}),Q=l=>{if(!l)return"C";const s=l.split(" ");return s.length>1?`${s[0][0]}${s[1][0]}`.toUpperCase():l.substring(0,2).toUpperCase()},pe=(l,s)=>l?l.length>s?l.substring(0,s)+"...":l:"",I=l=>({pending:"Pending",under_review:"Under Review",resolved:"Resolved",archived:"Archived"})[l]||l,W=l=>({pending:"warning",under_review:"info",resolved:"success",archived:"secondary"})[l]||"secondary",ve=l=>l>=4?"success":l>=3?"warning":"danger",O=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"";return fe(()=>v.visible,l=>f(null,null,function*(){l&&(yield G(),yield k())})),se(()=>{v.visible&&(G(),k())}),(l,s)=>{const A=_e("tooltip");return u(),j(t(Y),{visible:N.value,"onUpdate:visible":s[12]||(s[12]=P=>N.value=P),header:"Client Feedback Management",modal:!0,draggable:!1,resizable:!1,class:"feedback-dialog"},{footer:r(()=>[e("div",ks,[o(t(c),{label:"Close",onClick:s[11]||(s[11]=P=>N.value=!1)})])]),default:r(()=>{var P;return[e("div",Ve,[e("div",Pe,[e("div",je,[e("div",Ue,[e("div",xe,[s[13]||(s[13]=e("label",null,"Search",-1)),o(t(Ce),{modelValue:t(n).filters.search,"onUpdate:modelValue":s[0]||(s[0]=a=>t(n).filters.search=a),placeholder:"Search feedback, client name, or project...",onInput:t(ie),class:"search-input"},null,8,["modelValue","onInput"])]),e("div",Le,[s[14]||(s[14]=e("label",null,"Project",-1)),o(t(U),{modelValue:t(n).filters.project_id,"onUpdate:modelValue":s[1]||(s[1]=a=>t(n).filters.project_id=a),options:m.value,optionLabel:"name",optionValue:"id",placeholder:"All Projects",showClear:"",onChange:D,class:"project-filter"},null,8,["modelValue","options"])]),e("div",De,[s[15]||(s[15]=e("label",null,"Status",-1)),o(t(U),{modelValue:t(n).filters.status,"onUpdate:modelValue":s[2]||(s[2]=a=>t(n).filters.status=a),options:q,optionLabel:"label",optionValue:"value",placeholder:"All Status",showClear:"",onChange:D},null,8,["modelValue"])]),e("div",Ae,[s[16]||(s[16]=e("label",null,"Rating",-1)),o(t(U),{modelValue:t(n).filters.rating,"onUpdate:modelValue":s[3]||(s[3]=a=>t(n).filters.rating=a),options:ne,optionLabel:"label",optionValue:"value",placeholder:"All Ratings",showClear:"",onChange:D},null,8,["modelValue"])])]),e("div",Ee,[o(t(c),{icon:"pi pi-refresh",label:"Refresh",onClick:k,loading:t(n).loading,class:"p-button-outlined"},null,8,["loading"]),t(S).hasAnyRole(["admin","project_manager"])?(u(),j(t(c),{key:0,icon:"pi pi-download",label:"Export",onClick:ce,severity:"secondary",class:"p-button-outlined"})):g("",!0),o(t(c),{icon:"pi pi-filter-slash",label:"Clear Filters",onClick:de,severity:"secondary",class:"p-button-text"})])])]),t(n).feedback.length>0?(u(),h("div",Me,[o(t(E),{class:"stat-card"},{content:r(()=>[e("div",Ne,[e("div",Ie,d(t(n).statistics.total_feedback||0),1),s[17]||(s[17]=e("div",{class:"stat-label"},"Total Feedback",-1))])]),_:1}),o(t(E),{class:"stat-card"},{content:r(()=>[e("div",Oe,[e("div",Be,d(t(n).statistics.average_rating||"0.0"),1),s[18]||(s[18]=e("div",{class:"stat-label"},"Avg. Rating",-1))])]),_:1}),o(t(E),{class:"stat-card"},{content:r(()=>[e("div",Te,[e("div",ze,d(ae.value),1),s[19]||(s[19]=e("div",{class:"stat-label"},"Pending",-1))])]),_:1}),o(t(E),{class:"stat-card"},{content:r(()=>[e("div",Ye,[e("div",qe,d(le.value),1),s[20]||(s[20]=e("div",{class:"stat-label"},"Resolved",-1))])]),_:1})])):g("",!0),e("div",Ge,[o(t(we),{value:t(n).filteredFeedback,loading:t(n).loading,paginator:!0,rows:t(n).pagination.per_page,totalRecords:t(n).pagination.total,lazy:!0,onPage:re,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} entries",responsiveLayout:"scroll",class:"feedback-table"},{empty:r(()=>s[21]||(s[21]=[e("div",{class:"empty-state"},[e("i",{class:"pi pi-comment empty-icon"}),e("h3",null,"No feedback found"),e("p",null,"No client feedback matches your current filters.")],-1)])),loading:r(()=>[e("div",as,[o(t(Re)),s[22]||(s[22]=e("p",null,"Loading feedback...",-1))])]),default:r(()=>[o(t(R),{field:"client_name",header:"Client",sortable:!0},{body:r(({data:a})=>[e("div",He,[e("div",Je,[o(t(Z),{label:Q(a.client_name),size:"normal",class:"client-avatar-icon"},null,8,["label"])]),e("div",Ke,[e("strong",null,d(a.client_name),1),e("small",null,d(a.client_email),1)])])]),_:1}),o(t(R),{field:"project",header:"Project",sortable:!0},{body:r(({data:a})=>[a.project?(u(),h("div",Qe,[e("strong",null,d(a.project.name),1),e("small",null,d(a.project.client_name),1)])):(u(),h("span",We,"No project"))]),_:1}),o(t(R),{field:"rating",header:"Rating",sortable:!0},{body:r(({data:a})=>[e("div",Xe,[o(t(X),{"model-value":a.rating,readonly:!0,cancel:!1,class:"feedback-rating"},null,8,["model-value"]),o(t(B),{value:a.rating+"/5",severity:ve(a.rating),class:"rating-badge"},null,8,["value","severity"])])]),_:1}),o(t(R),{field:"comment",header:"Feedback",class:"comment-column"},{body:r(({data:a})=>[e("div",Ze,[e("p",null,d(pe(a.comment,100)),1),a.comment&&a.comment.length>100?(u(),j(t(c),{key:0,label:"Read More",class:"p-button-text p-button-sm read-more-btn",onClick:y=>H(a)},null,8,["onClick"])):g("",!0)])]),_:1}),o(t(R),{field:"status",header:"Status",sortable:!0},{body:r(({data:a})=>[e("div",es,[o(t(B),{value:I(a.status),severity:W(a.status)},null,8,["value","severity"]),e("small",ss,d(O(a.updated_at)),1)])]),_:1}),o(t(R),{header:"Actions",class:"actions-column"},{body:r(({data:a})=>[e("div",ts,[z(o(t(c),{icon:"pi pi-eye",class:"p-button-text p-button-sm",onClick:y=>H(a)},null,8,["onClick"]),[[A,"View Details"]]),z(o(t(c),{icon:"pi pi-reply",class:"p-button-text p-button-sm",onClick:y=>J(a),disabled:a.status==="resolved"},null,8,["onClick","disabled"]),[[A,"Respond"]]),t(S).hasAnyRole(["admin","project_manager"])?(u(),j(t(U),{key:0,options:oe,optionLabel:"label",optionValue:"value",onChange:y=>ue(a,y.value),placeholder:"Update Status",class:"status-dropdown"},{trigger:r(()=>[z(o(t(c),{icon:"pi pi-cog",class:"p-button-text p-button-sm"},null,512),[[A,"Update Status"]])]),_:2},1032,["onChange"])):g("",!0)])]),_:1})]),_:1},8,["value","loading","rows","totalRecords"])])]),o(t(Y),{visible:$.value,"onUpdate:visible":s[6]||(s[6]=a=>$.value=a),header:`Feedback from ${(P=i.value)==null?void 0:P.client_name}`,modal:!0,class:"feedback-detail-dialog"},{footer:r(()=>{var a,y;return[o(t(c),{label:"Close",onClick:s[4]||(s[4]=me=>$.value=!1)}),(a=i.value)!=null&&a.response?g("",!0):(u(),j(t(c),{key:0,label:"Respond",onClick:s[5]||(s[5]=me=>J(i.value)),disabled:((y=i.value)==null?void 0:y.status)==="resolved"},null,8,["disabled"]))]}),default:r(()=>[i.value?(u(),h("div",ls,[e("div",os,[e("div",ns,[o(t(Z),{label:Q(i.value.client_name),size:"large"},null,8,["label"]),e("div",is,[e("h3",null,d(i.value.client_name),1),e("p",null,d(i.value.client_email),1),e("small",null,d(O(i.value.created_at)),1)])]),e("div",rs,[e("div",ds,[o(t(X),{"model-value":i.value.rating,readonly:!0,cancel:!1},null,8,["model-value"]),e("span",cs,d(i.value.rating)+"/5 Stars",1)]),o(t(B),{value:I(i.value.status),severity:W(i.value.status),class:"status-badge"},null,8,["value","severity"])])]),o(t(Fe)),e("div",us,[s[25]||(s[25]=e("h4",null,"Feedback Comment",-1)),e("p",ps,d(i.value.comment),1),i.value.project?(u(),h("div",vs,[s[23]||(s[23]=e("h4",null,"Project Context",-1)),e("div",ms,[e("strong",null,d(i.value.project.name),1),e("p",null,d(i.value.project.description),1)])])):g("",!0),i.value.response?(u(),h("div",bs,[s[24]||(s[24]=e("h4",null,"Our Response",-1)),e("div",fs,[e("p",null,d(i.value.response),1),e("small",null,"Responded on "+d(O(i.value.response_date)),1)])])):g("",!0)])])):g("",!0)]),_:1},8,["visible","header"]),o(t(Y),{visible:V.value,"onUpdate:visible":s[10]||(s[10]=a=>V.value=a),header:"Respond to Feedback",modal:!0,class:"response-dialog"},{footer:r(()=>[o(t(c),{label:"Cancel",severity:"secondary",onClick:s[9]||(s[9]=a=>V.value=!1)}),o(t(c),{label:"Send Response",onClick:K,loading:M.value,disabled:!b.value.message.trim()},null,8,["loading","disabled"])]),default:r(()=>[e("form",{onSubmit:ge(K,["prevent"]),class:"response-form"},[e("div",gs,[s[26]||(s[26]=e("label",{for:"response"},"Your Response *",-1)),o(t(Se),{id:"response",modelValue:b.value.message,"onUpdate:modelValue":s[7]||(s[7]=a=>b.value.message=a),rows:"6",placeholder:"Enter your response to the client's feedback...",invalid:!!F.value.message,class:"w-full"},null,8,["modelValue","invalid"]),F.value.message?(u(),h("small",_s,d(F.value.message),1)):g("",!0)]),e("div",hs,[s[27]||(s[27]=e("label",{for:"responseStatus"},"Update Status",-1)),o(t(U),{id:"responseStatus",modelValue:b.value.status,"onUpdate:modelValue":s[8]||(s[8]=a=>b.value.status=a),options:q.filter(a=>a.value!=="pending"),optionLabel:"label",optionValue:"value",placeholder:"Select new status",class:"w-full"},null,8,["modelValue","options"])])],32)]),_:1},8,["visible"])]}),_:1},8,["visible"])}}},ws=te(ys,[["__scopeId","data-v-222d228c"]]),Cs={class:"feedback-view"},Ss={class:"page-header"},Fs={class:"header-content"},Rs={class:"header-info"},$s={class:"header-actions"},Vs={class:"feedback-content"},Ps={__name:"FeedbackView",setup(x){const w=ee(),v=_([{label:"Dashboard",icon:"pi pi-home",route:"/employee/dashboard"},{label:"Client Feedback"}]),C=()=>f(null,null,function*(){yield w.fetchFeedback()});return se(()=>f(null,null,function*(){document.title="Client Feedback - Employee Portal",yield C()})),(S,n)=>(u(),h("div",Cs,[e("div",Ss,[e("div",Fs,[e("div",Rs,[o(t(be),{model:v.value},null,8,["model"]),n[0]||(n[0]=e("h1",null,"Client Feedback",-1)),n[1]||(n[1]=e("p",null,"View and respond to client feedback",-1))]),e("div",$s,[o(t(c),{icon:"pi pi-refresh",label:"Refresh",onClick:C,loading:t(w).loading,severity:"secondary",outlined:""},null,8,["loading"])])])]),e("div",Vs,[o(ws,{visible:!0,"onUpdate:visible":()=>{}})])]))}},Ws=te(Ps,[["__scopeId","data-v-d5882f96"]]);export{Ws as default};
